<!DOCTYPE html>  
<html lang="pt-BR">  

<head>  
<meta charset="UTF-8">  
<meta name="viewport" content="width=device-width, initial-scale=1.0">  
<title>Zyk Kesir RPG</title>  
<style>  
  body {  
    margin: 0;  
    font-family: 'Poppins', sans-serif;  
    background-color: #0a0a0a;  
    color: white;  
  }  
  header {
    background: #111;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 20px;
  }

  .logo { font-size:1.5em; color:red; font-weight:bold; }

  nav { display:flex; gap:15px; }

  nav a { color:white; text-decoration:none; padding:6px 10px; border-radius:6px; transition:0.3s; }

  nav a:hover { background:red; }

  .menu-toggle { display:none; font-size:1.5em; cursor:pointer; }

  #content { padding:20px; }

  .topic { background:#1a1a1a; margin:15px 0; border-radius:10px; padding:10px; cursor:pointer; transition:0.3s; }

  .topic:hover { background:#222; }

  .topic img { width:100%; border-radius:10px; }

  .topic-title { color:red; font-weight:bold; margin-top:8px; }

  #addBtn { position:fixed; bottom:20px; right:20px; background:red; color:white; font-size:1.5em; border:none; border-radius:50%; width:50px; height:50px; cursor:pointer; transition:0.3s; }

  #addBtn:hover { background:#b30000; }

  #modal, #deleteModal, #loginScreen { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); justify-content:center; align-items:center; z-index:10; }

  #modal-content, #deleteModal-content, #login-content { background:#111; padding:20px; border-radius:10px; width:90%; max-width:400px; box-shadow:0 0 15px rgba(255,0,0,0.3); }

  #modal-content input, #modal-content textarea, #deletePassword, #login-content input { width:100%; margin-bottom:10px; padding:8px; border:none; border-radius:6px; background:#222; color:white; }

  #modal-content button, #deleteModal-content button, #login-content button { background:red; border:none; padding:10px; border-radius:6px; color:white; width:100%; cursor:pointer; transition:0.3s; }

  #modal-content button:hover, #deleteModal-content button:hover, #login-content button:hover { background:#b30000; }

  #deleteModal-buttons { display:flex; justify-content:space-between; gap:10px; }

  #cancelDelete { background:#333; }

  #cancelDelete:hover { background:#444; }

  #detailView { display:none; padding:20px; }

  .btn { display:inline-block; padding:10px 18px; border-radius:8px; border:1px solid red; background:transparent; color:red; font-weight:500; cursor:pointer; transition:0.3s; }

  .btn:hover { background:red; color:white; }

  #backBtn { margin-bottom:20px; }

  #deleteBtn, #editBtn { display:block; margin:20px auto 0; }

  .detail-text { white-space:pre-line; line-height:1.5; }

  @media(max-width: 768px) { 
    nav{ display:none; flex-direction:column; background:#111; position:absolute; top:60px; right:0; width:200px; } 
    nav.active{ display:flex; } 
    .menu-toggle{ display:block; } 
  } 
</style>

</head>  
<body>  
  <!-- LOGIN -->  
  <div id="loginScreen">  
    <div id="login-content">  
      <h2 style="color:red; text-align:center;">Zyk Kesir RPG</h2>  
      <input type="text" id="username" placeholder="Usuário">  
      <input type="password" id="password" placeholder="Senha">  
      <button id="loginBtn">Entrar</button>  
      <p style="text-align:center; font-size:0.9em; color:#aaa;">Player: 123</p>  
    </div>  
  </div>  

  <header>  
    <div class="logo">Zyk Kesir RPG</div>  
    <div class="menu-toggle" id="menuToggle">☰</div>  
    <nav id="menu">  
      <a href="#" data-tab="ranking">Ranking</a>  
      <a href="#" data-tab="batalhas">Batalhas</a>  
      <a href="#" data-tab="armas">Armas</a>  
      <a href="#" data-tab="dragoes">Dragões</a>  
      <a href="#" data-tab="casas">Casas</a>  
      <a href="#" data-tab="personagens">Personagens</a>  
      <a href="#" data-tab="animais">Animais</a>  
      <a href="#" data-tab="torneios">Torneios</a>  
      <a href="#" data-tab="regioes">Regiões</a>  
    </nav>  
  </header>  

  <main id="content"></main>  

  <div id="detailView">  
    <button class="btn" id="backBtn">Voltar</button>  
    <div id="detailContent"></div>  
  </div>  

  <button id="addBtn">+</button>

  <div id="modal">  
    <div id="modal-content">  
      <input type="file" id="imageInput" accept="image/*">  
      <input type="text" id="titleInput" placeholder="Título (vermelho)">  
      <textarea id="textInput" placeholder="Digite o texto..."></textarea>  
      <button id="saveBtn">Enviar</button>  
    </div>  
  </div>  

  <div id="deleteModal">  
    <div id="deleteModal-content">  
      <h3 style="color:red; text-align:center;">Confirmar exclusão</h3>  
      <p style="text-align:center;">Digite a senha para apagar:</p>  
      <input type="password" id="deletePassword" placeholder="Senha">  
      <div id="deleteModal-buttons">  
        <button id="cancelDelete">Cancelar</button>  
        <button id="confirmDelete">Apagar</button>  
      </div>  
    </div>  
  </div>  

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Configuração do Supabase
    const supabaseUrl = 'https://zoztapepviyezjoagawe.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpvenRhcGVwdml5ZXpqb2FnYXdlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNDY1NzQsImV4cCI6MjA3NzkyMjU3NH0.2L0CN2WhXvH1K1y-xCi3y8prQOTkQP_suE4gFFKlzP0';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    const loginScreen = document.getElementById('loginScreen');  
    const loginBtn = document.getElementById('loginBtn');  
    const username = document.getElementById('username');  
    const password = document.getElementById('password');  
    const addBtn = document.getElementById('addBtn');  
    const saveBtn = document.getElementById('saveBtn');  
    const confirmDelete = document.getElementById('confirmDelete');  

    let currentTab = 'ranking';
    let deleteIndex = null;
    let editIndex = null;
    let currentRole = null; // "adm" ou "player"
    let currentData = [];

    // LOGIN
    loginScreen.style.display = 'flex';
    loginBtn.addEventListener('click', () => {
      const user = username.value.trim();
      const pass = password.value.trim();
      if ((user.toLowerCase() === 'adm' && pass === 'P3drov3g3ta') || (user.toLowerCase() === 'player' && pass === '123')) {
        currentRole = user.toLowerCase();
        loginScreen.style.display = 'none';
        renderTab();
        if (currentRole === 'player') addBtn.style.display = 'none';
      } else {
        alert('Usuário ou senha incorretos!');
      }
    });

    // RESTO DO SITE
    const menu = document.getElementById('menu');
    const menuToggle = document.getElementById('menuToggle');
    const content = document.getElementById('content');
    const modal = document.getElementById('modal');
    const deleteModal = document.getElementById('deleteModal');
    const detailView = document.getElementById('detailView');
    const detailContent = document.getElementById('detailContent');
    const backBtn = document.getElementById('backBtn');
    const cancelDelete = document.getElementById('cancelDelete');
    const deletePassword = document.getElementById('deletePassword');
    const imageInput = document.getElementById('imageInput');
    const titleInput = document.getElementById('titleInput');
    const textInput = document.getElementById('textInput');

    async function renderTab() {
      content.innerHTML = '<p style="text-align:center;">Carregando...</p>';
      detailView.style.display = 'none';
      content.style.display = 'block';

      try {
        // Buscar dados do Supabase
        const { data: items, error } = await supabase
          .from(currentTab)
          .select('*')
          .order('created_at', { ascending: false });

        if (error) throw error;

        currentData = items || [];
        content.innerHTML = '';

        if (currentData.length === 0) {
          content.innerHTML = '<p style="text-align:center;">Nenhum item encontrado.</p>';
          return;
        }

        currentData.forEach((item, index) => {
          const div = document.createElement('div');
          div.className = 'topic';
          div.innerHTML = `  
            ${item.image ? <img src="${item.image}"> : ''}  
            <div class="topic-title">${item.title}</div>  
          `;
          div.addEventListener('click', () => openDetail(item, index));
          content.appendChild(div);
        });
      } catch (error) {
        console.error('Erro ao carregar dados:', error);
        content.innerHTML = '<p style="text-align:center;color:red;">Erro ao carregar dados.</p>';
      }
    }

    function openDetail(item, index) {
      content.style.display = 'none';
      detailView.style.display = 'block';
      detailContent.innerHTML = `  
        ${item.image ? <img src="${item.image}" style="width:100%;border-radius:10px;"> : ''}  
        <h2 style="color:red;">${item.title}</h2>  
        <p class="detail-text">${item.text}</p>  
        ${currentRole === 'adm' ? `
          <button class="btn" id="editBtn">Editar</button>
          <button class="btn" id="deleteBtn">Apagar</button>
        ` : ''}  
      `;

      if (currentRole === 'adm') {
        document.getElementById('deleteBtn').addEventListener('click', () => {
          deleteIndex = index;
          deletePassword.value = '';
          deleteModal.style.display = 'flex';
        });

        document.getElementById('editBtn').addEventListener('click', () => {
          editIndex = index;
          const itemToEdit = currentData[index];
          titleInput.value = itemToEdit.title;
          textInput.value = itemToEdit.text;
          modal.style.display = 'flex';
        });
      }
    }

    confirmDelete.addEventListener('click', async () => {
      if (deletePassword.value === 'Galo') {
        try {
          const itemToDelete = currentData[deleteIndex];
          
          const { error } = await supabase
            .from(currentTab)
            .delete()
            .eq('id', itemToDelete.id);

          if (error) throw error;

          deleteModal.style.display = 'none';
          renderTab();
          detailView.style.display = 'none';
          content.style.display = 'block';
        } catch (error) {
          console.error('Erro ao deletar:', error);
          alert('Erro ao deletar item.');
        }
      } else {
        alert('Senha incorreta!');
      }
    });

    cancelDelete.addEventListener('click', () => {
      deleteModal.style.display = 'none';
    });

    backBtn.addEventListener('click', () => {
      detailView.style.display = 'none';
      content.style.display = 'block';
    });

    menuToggle.addEventListener('click', () => {
      menu.classList.toggle('active');
    });

    menu.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        currentTab = link.dataset.tab;
        renderTab();
        menu.classList.remove('active');
      });
    });

    addBtn.addEventListener('click', () => {
      editIndex = null;
      modal.style.display = 'flex';
      titleInput.value = '';
      textInput.value = '';
      imageInput.value = '';
    });

    saveBtn.addEventListener('click', async () => {
      const text = textInput.value;
      const title = titleInput.value;

      if (!title || !text) {
        alert('Preencha título e texto!');
        return;
      }

      try {
        if (imageInput.files[0]) {
          const reader = new FileReader();
          reader.onload = async e => {
            const newItem = { 
              image: e.target.result, 
              title, 
              text 
            };

            if (editIndex !== null) {
              // Atualizar item existente
              const itemToUpdate = currentData[editIndex];
              const { error } = await supabase
                .from(currentTab)
                .update(newItem)
                .eq('id', itemToUpdate.id);

              if (error) throw error;
            } else {
              // Criar novo item
              const { error } = await supabase
                .from(currentTab)
                .insert([newItem]);

              if (error) throw error;
            }

            modal.style.display = 'none';
            renderTab();
          };
          reader.readAsDataURL(imageInput.files[0]);
        } else {
          const newItem = {
            image: editIndex !== null ? currentData[editIndex].image : null,
            title, 
            text
          };

          if (editIndex !== null) {
            // Atualizar item existente
            const itemToUpdate = currentData[editIndex];
            const { error } = await supabase
              .from(currentTab)
              .update(newItem)
              .eq('id', itemToUpdate.id);

            if (error) throw error;
          } else {
            // Criar novo item
            const { error } = await supabase
              .from(currentTab)
              .insert([newItem]);

            if (error) throw error;
          }

          modal.style.display = 'none';
          renderTab();
        }
      } catch (error) {
        console.error('Erro ao salvar:', error);
        alert('Erro ao salvar item.');
      }
    });

    window.onclick = e => {
      if (e.target === modal) modal.style.display = 'none';
      if (e.target === deleteModal) deleteModal.style.display = 'none';
    };
  </script>  
</body>
</html>